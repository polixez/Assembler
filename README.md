# Ассемблер и Интерпретатор Учебной Виртуальной Машины (УВМ)

---

## 1. Общее описание

Данный проект реализует ассемблер и интерпретатор для учебной виртуальной машины (УВМ) на языке Python. Ассемблер переводит исходный код программы, написанный на ассемблере УВМ, в бинарный файл, понятный виртуальной машине, а также создает лог-файл в формате XML с информацией об ассемблированных инструкциях. Интерпретатор выполняет бинарный файл, интерпретируя инструкции УВМ, и сохраняет результаты выполнения в файл-результат в формате XML, отображающий значения в памяти УВМ после выполнения программы.

Проект включает автоматический скрипт сборки, который последовательно запускает ассемблер и интерпретатор, упрощая процесс разработки и тестирования программ для УВМ.

---

## 2. Функции и настройки
### Основные компоненты

1. **Ассемблер (```assembler.py```)**

- Цель: Переводит исходный код программы на языке ассемблера УВМ в бинарный файл (```binary.bin```) и создает лог-файл (```log.xml```) с информацией об инструкциях.
- Функции:

    - ```assemble_instruction(line)```: Парсит строку исходного кода и преобразует её в бинарную инструкцию.
    - ```assemble(source_file, binary_file, log_file)```: Обрабатывает весь исходный файл, генерирует бинарный файл и лог-файл.
- Настройки:
    - Аргументы командной строки:
        - ```<source_file>```: Путь к исходному файлу программы (например, test_files/test_source.asm).
        - ```<binary_file>```: Путь для сохранения бинарного файла (например, test_files/binary.bin).
        - ```<log_file>```: Путь для сохранения лог-файла (например, test_files/log.xml).

2. **Интерпретатор (```interpreter.py```)**

- Цель: Выполняет бинарный файл программы УВМ и создает файл-результат (```result.xml```) с дампом памяти после выполнения.
- Функции:
    - ```interpret(binary_file, memory_dump_file, mem_start, mem_end```): Выполняет инструкции из бинарного файла и сохраняет результат в указанный диапазон памяти.
- Настройки:
    - Аргументы командной строки:
        - ```<binary_file>```: Путь к бинарному файлу программы (например, test_files/binary.bin).
        - ```<memory_dump_file>```: Путь для сохранения файла-результата (например, test_files/result.xml).
        - ```<mem_start>```: Начальный адрес памяти для дампа.
        - ```<mem_end>```: Конечный адрес памяти для дампа.

3. **Файл-скрипт для автоматической сборки (```build.py```)**

- Цель: Автоматизирует процесс сборки и выполнения программы, последовательно запускает ассемблер и интерпретатор.
- Функции:
    - ```main()```: Определяет пути к файлам, формирует команды для ассемблера и интерпретатора, выполняет их, обрабатывает результаты.
- Настройки:
    - Пути к файлам задаются внутри скрипта и могут быть изменены при необходимости.


### Поддерживаемые команды УВМ

1. **LDC (Load Constant)**

    Описание: Загружает константу в аккумулятор.
    
    Формат: ```LDC <константа>```

    Пример: ```LDC 10```
2. **LD (Load)**

    Описание: Читает значение из памяти по адресу аккумулятор + смещение и загружает его в аккумулятор.

    Формат: ```LD <смещение>```

    Пример: ```LD 5```

3. **ST (Store)**

    Описание: Сохраняет значение аккумулятора в память по указанному адресу.

    Формат: ```ST <адрес>```

    Пример: ```ST 15```

4. **EQ (Equal)**

    Описание: Сравнивает аккумулятор с значением из памяти по адресу, сохраняет результат (1 или 0) в аккумулятор.

    Формат: ```EQ <адрес>```

    Пример: ```EQ 20```

---
## 3. Команды для сборки проекта
Для автоматической сборки проекта используется скрипт ```build.py```, который последовательно запускает ассемблер и интерпретатор.

### Сборка и запуск тестов:
**Запуск сборки через ```build.py```:**

```python
import sys
import os

def build_project():
    # Пути к файлам
    source_file = 'test_files/test_source.asm'
    binary_file = 'test_files/binary.bin'
    log_file = 'test_files/log.xml'
    memory_dump_file = 'test_files/result.xml'
    mem_start = 0
    mem_end = 7

    # Шаг 1: Ассемблирование исходного кода
    print("Ассемблирование исходного кода...")
    os.system(f'python assembler.py {source_file} {binary_file} {log_file}')

    # Шаг 2: Запуск интерпретатора
    print("Выполнение интерпретатора...")
    os.system(f'python interpreter.py {binary_file} {memory_dump_file} {mem_start} {mem_end}')

    print("Сборка и выполнение завершены.")

if __name__ == "__main__":
    build_project()
```

Скрипт выполняет следующие действия:

1. **Запуск ассемблера:**

- Ассемблирует исходный код из ```test_files/test_source.asm``` в бинарный файл ```test_files/binary.bin.```
- Создает лог-файл ```test_files/log.xml``` с информацией об инструкциях.

2. **Запуск интерпретатора:**

- Выполняет инструкции из ```test_files/binary.bin.```
- Создает файл-результат ```test_files/result.xml``` с дампом памяти по адресам 0–7.

---

## 4. Примеры использования

### Запуск Автоматической Сборки
**Команда:**

```powershell
python build.py
```

**Описание:**

При запуске скрипта ```build.py``` происходит автоматическая ассемблировка и выполнение программы. В терминале отображаются сообщения о запуске и успешном выполнении ассемблера и интерпретатора.

### Результаты Выполнения Ассемблированной Программы
**Команда:**

```powershell
python interpreter.py test_files/binary.bin test_files/result.xml 0 7
```

![Снимок экрана 2024-11-27 064800](https://github.com/user-attachments/assets/7c159b24-9f3d-4889-8c75-f2273d0d96f9)

**Описание:**

После выполнения интерпретатора создается файл result.xml, который содержит дамп памяти. В этом примере показаны значения векторов A и B после выполнения программы, где векторы B обновлены результатами сравнения.

### Проверка Бинарного Файла в HxD

**Действия:**

1. Откройте binary.bin в HxD.
2. Проверьте, что каждая инструкция занимает 4 байта и соответствует ожиданиям.

![Снимок экрана 2024-11-27 064819](https://github.com/user-attachments/assets/f21542f0-22ff-46e0-8352-bff86061fa74)

**Описание:**

В HxD можно убедиться, что бинарный файл ```binary.bin``` содержит правильные инструкции в формате little-endian, соответствующие лог-файлу ```log.xml```.


---

## 5. Результаты прогона тестов

### Запуск тестов
Для проверки корректности работы всех функций и компонентов проекта используется автоматический файл-скрипт ```build.py```.

**Команда для запуска тестов через автоматический скрипт:**

```bash
python build.py
```

**Результаты выполнения тестов:**


**Все тесты прошли успешно, подтверждая полное соответствие функционала требованиям задания.**
